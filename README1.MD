# Изменения в проекте

## Реализация двухфакторной аутентификации (2FA)

### 1. Изменения в AuthIntegrationHandler
- Добавлена проверка 2FA перед основной аутентификацией
- Реализована обработка ответа с кодом `require2fa`
- Добавлено сообщение "Введите код из приложения 2FA" при необходимости ввода 2FA кода

### 2. Изменения в UnicoreCMSAuthService
- Добавлена обработка ответа от сервера с проверкой на `require2fa`
- Реализована логика возврата статуса и сообщения о необходимости 2FA
- Добавлена передача TOTP кода в запросе аутентификации

### 3. Изменения в моделях
- В `BaseUserPassword` добавлено поле для 2FA кода
- Добавлены JSON-атрибуты для корректного маппинга полей
- Переименование поля с `TwoFactorCode` на `2FACode` для API

### 4. Изменения в AuthService
- Добавлен параметр TOTP в метод `CheckAuth`
- Реализована валидация TOTP кода
- Обновлен интерфейс `IAuthService`

### 5. Процесс аутентификации
1. Пользователь отправляет логин и пароль
2. Если 2FA включен:
   - Сервер возвращает статус 401 с сообщением "Введите код из приложения 2FA"
   - Клиент должен отправить повторный запрос с 2FA кодом
3. После успешной проверки 2FA кода происходит полная аутентификация

### 6. Форматы запросов

#### Первичная аутентификация
```json
{
    "login": "username",
    "password": "userpassword"
}
```

#### Аутентификация с 2FA
```json
{
    "login": "username",
    "password": "userpassword",
    "2FACode": "123456"
}
```

### 7. Возможные ответы сервера

#### Требуется 2FA
```json
{
    "status": "Unauthorized",
    "statusCode": 401,
    "message": "Введите код из приложения 2FA"
}
```

#### Неверные учетные данные
```json
{
    "status": "Unauthorized",
    "statusCode": 401,
    "message": "Неверный логин или пароль"
}
```

#### Успешная аутентификация
```json
{
    "status": "OK",
    "statusCode": 200,
    "data": {
        // Данные пользователя
    }
}
``` 